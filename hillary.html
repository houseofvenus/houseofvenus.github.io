<!DOCTYPE html>
<html>
<head>
    <title>Hillary Yeboah | Old Row Maryland | v. 0.2.4</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="./js/aframe100.js"></script><!--https://aframe.io/releases/1.0.0/-->
    <script src="./js/aframe-ar.js"></script><!-- https://raw.githack.com/jeromeetienne/AR.js/2.2.0/aframe/build/-->
    <script>
        let MarkerGridTracker = {
            nyt : {
                initiated: false,
                active: false,
                tapping: false,
                counter: 0
            },
            mit : {
                initiated: false,
                active: false,
                tapping: false,
                counter: 0
            },
            hiro : {
                initiated: false,
                active: false,
                tapping: false,
                counter: 0
            },
            unibeat : {
                initiated: false,
                active: false,
                tapping: false,
                counter: 0
            }
        };
        
        document.addEventListener("DOMContentLoaded", function(){
            document.getElementById("nyt-marker-container").addEventListener("markerLost", function(){
                if(MarkerGridTracker.nyt.initiated){
                    console.log("start finger counter");
                    MarkerGridTracker.nyt.counter = new Date().getTime();
                }
                else{
                    console.log("probably just a camera issue");
                }
            });
            
            document.getElementById("mit-marker-container").addEventListener("markerLost", function(){
                if(MarkerGridTracker.mit.initiated){
                    console.log("start finger counter");
                    MarkerGridTracker.mit.counter = new Date().getTime();
                }
                else{
                    console.log("probably just a camera issue");
                }
            });
            
            document.getElementById("hiro-marker-container").addEventListener("markerLost", function(){
                if(MarkerGridTracker.hiro.initiated){
                    console.log("start finger counter");
                    MarkerGridTracker.hiro.counter = new Date().getTime();
                }
                else{
                    console.log("probably just a camera issue");
                }
            });
            
            document.getElementById("unibeat-marker-container").addEventListener("markerLost", function(){
                if(MarkerGridTracker.unibeat.initiated){
                    console.log("start finger counter");
                    MarkerGridTracker.unibeat.counter = new Date().getTime();
                }
                else{
                    console.log("probably just a camera issue");
                }
            });
            
            
            
            
            
            document.getElementById("nyt-marker-container").addEventListener("markerFound", function(){
                let stopTime = new Date().getTime();
                let timeDiff = stopTime-MarkerGridTracker.nyt.counter;
                
                console.log(`${timeDiff} has elapsed`);
                
                if(MarkerGridTracker.nyt.initiated){
                    if(MarkerGridTracker.nyt.active){
                        console.log("marker content already activated");
                    }
                    else{
                        if(timeDiff>=3000 && timeDiff<=6000){
                            console.log("show content from option selection");

                            document.getElementById("nyt-rotating-globe").emit("stopRotatingNYT");
                            document.getElementById("nyt-rotating-globe").setAttribute("visible",false);
                            
                            document.getElementById("nyt-application-panel").emit("showPanelNYT");
                            document.getElementById("nyt-application-panel").setAttribute("visible",true);
                            MarkerGridTracker.nyt.active = true;
                        }
                        else{
                            console.log("missed content trigger window\nresetting timer.");
                            MarkerGridTracker.nyt.counter = 0;
                        }
                    }
                    
                }
                else{
                    console.log("activating marker\nshow initial content");
                    MarkerGridTracker.nyt.initiated = true;
                }
            });
            
            document.getElementById("mit-marker-container").addEventListener("markerFound", function(){
                if(MarkerGridTracker.mit.initiated){
                    console.log("show content from option selection");
                }
                else{
                    console.log("activating marker\nshow initial content");
                    MarkerGridTracker.mit.initiated = true;
                }
            });
            
            document.getElementById("hiro-marker-container").addEventListener("markerFound", function(){
                if(MarkerGridTracker.hiro.initiated){
                    console.log("show content from option selection");
                }
                else{
                    console.log("activating marker\nshow initial content");
                    MarkerGridTracker.hiro.initiated = true;
                }
            });
            
            document.getElementById("unibeat-marker-container").addEventListener("markerFound", function(){
                if(MarkerGridTracker.unibeat.initiated){
                    console.log("show content from option selection");
                }
                else{
                    console.log("activating marker\nshow initial content");
                    MarkerGridTracker.unibeat.initiated = true;
                }
            });
        });
    </script>
</head>
<body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs>
        <a-assets timeout="10000">
            <img id="mercury-planet-object-texture" src="./media/texture/mercurymap.jpg" preload="true" />
            <img id="venus-planet-object-texture" src="./media/texture/venusmap.jpg" preload="true" />
            <img id="earth-planet-object-texture" src="./media/texture/earthmap1k.jpg" preload="true" />
            <img id="jupiter-planet-object-texture" src="./media/texture/jupiter2_2k.jpg" preload="true" />
        </a-assets>
        
        <a-marker id="nyt-marker-container" type="pattern" url="./media/pattern/pattern-nyt-marker-candidate.patt">
            <a-entity id="nyt-rotating-globe"
                      geometry="primitive:sphere; radius: 0.5;"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear; pauseEvents: stopRotatingNYT;"
                      position="0 0.5 0"
                      material="src: #mercury-planet-object-texture"></a-entity>
            <a-entity id="nyt-application-panel"
                      geometry="primitive: plane; width: 5; height: 2.5;"
                      animation="property: material.opacity; to: 1.0; dur: 1000; easing: linear; startEvents: showPanelNYT;"
                      position="0 0.25 0"
                      rotation="0 -90 0"
                      visible="false"
                      material="color: red; opacity: 0; side:double;"></a-entity>
        </a-marker>
        
        <a-marker id="mit-marker-container" type="pattern" url="./media/pattern/pattern-mit-logo.patt">
            <a-entity
                      geometry="primitive:sphere; radius: 0.5;"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
                      position='0 0.5 0'
                      material='src: #venus-planet-object-texture'></a-entity>
            <a-entity
                      geometry="primitive: plane; width: 3; height: 1.5;"
                      position="0 0.25 0"
                      visible="false"
                      material="color: blue; opacity: 0;"></a-entity>
        </a-marker>
        
        <a-marker id="hiro-marker-container" preset="hiro">
            <a-entity
                      geometry="primitive:sphere; radius: 0.5;"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
                      position='0 0.5 0'
                      material='src: #earth-planet-object-texture'></a-entity>
            <a-entity
                      geometry="primitive: plane; width: 3; height: 1.5;"
                      position="0 0.25 0"
                      visible="false"
                      material="color: green; opacity: 0;"></a-entity>
        </a-marker>
        
        <a-marker id="unibeat-marker-container" type="pattern" url="./media/pattern/pattern-unibeat.patt">
            <a-entity
                      geometry="primitive:sphere; radius: 0.5;"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
                      position='0 0.5 0'
                      material='src: #jupiter-planet-object-texture'></a-entity>
            <a-entity
                      geometry="primitive: plane; width: 3; height: 1.5;"
                      position="0 0.25 0"
                      visible="false"
                      material="color: yellow; opacity: 0;"></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>